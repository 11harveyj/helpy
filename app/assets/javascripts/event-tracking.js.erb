// Globale Event tracking hooks for Helpy/GA
// leverages flare.js for emiting event data

var Helpy = Helpy || {};
Helpy.track = function(){

  // Get the GA Universal Analytics ClientID.  This is used for server side tracking
  ga(function(tracker) {
    Helpy.clientId = tracker.get('clientId');
    $("#client_id").val(Helpy.clientId);
    console.log(Helpy.clientId);

    // Update links to pass the clientID as a QS param
    $('.ticket-controls > li > a, .topic-link > a, .mailbox > a').each(function(){
      var originalLink = $(this).attr("href");
      var divider = ((originalLink.indexOf("?") == -1) ? "?client_id=" : "&client_id=");
      $(this).attr("href", originalLink + divider + Helpy.clientId);
    });

  });


  // send search event to google
//  $('#search-form').unbind().on('submit', function(){
//    console.log($('#search-field').val())
//    ga('send', 'event', 'Search','Search', $('#search-field').val())
//  });

  // Search Events

  $('#page-title').find('#search-form').unbind().on('submit', function(){
    console.log('header search')
    ga('send', 'event', 'Search','Search', 'Header Search')
    ga('send', 'event', 'Search','Search', $('#search-field').val())
  });

  $('#home-search').find('#search-form').unbind().on('submit', function(){
    console.log('home page search')
    ga('send', 'event', 'Search','Search', 'Home Page')
    ga('send', 'event', 'Search','Search', $('#search-field').val())
  });


  $('.search-result > span > a').unbind().on('click', function(){
    console.log("Search Result Click")
    ga('send', 'event', 'Search','Result-Click', $('#search-field').val())
  });


  // main navigation events

  $('.navbar-brand').unbind().on('click', function(){
    console.log("Click Logo")
    ga('send', 'event', 'Main Nav','Click', 'Logo')

  });

  $('.navbar-nav > li > a, #above-header > small > a').on('click', function(){
    console.log($(this).text())
    flare.emit({
      category: "Main Nav",
      action: "Click",
      label: $(this).text()
    });
  });

  $('.get-help-button').on('click', function(){
    console.log($(this).text())
    flare.emit({
      category: "Main Nav",
      action: "Click",
      label: $(this).text()
    });
  });

  $('.breadcrumb > li > a').unbind().on('click', function(){
    console.log($(this).text())
    flare.emit({
      category: "Main Nav",
      action: "Click",
      label: "Breadcrumb: " + $(this).text()
    });
  });


  // Inpage events: Inpage events represent things that happen on the page but
  // do not involve global navigation

  $('.label-collapsed').unbind().on("click", function(){
    console.log($(this).text())
    ga('send', 'event', 'Inpage-Nav','Click', 'Show Hidden')
  })

  $('.topic-box').on("click", function(){
    console.log($(this).find('h5').text())
    ga('send', 'event', 'Inpage-Nav','Click', $(this).find('h5').text())
  });

  // Discussion Click
  $('tr.forum').find('a').unbind().on('click', function(){
    console.log("Clicked:" + $(this).text());
    ga('send', 'event', 'Inpage-nav','Click', "Forum: " + $(this).text());
  });

  $('tr.topic').find('a').unbind().on('click', function(){
    console.log("Clicked:" + $(this).text());
    ga('send', 'event', 'Inpage-nav','Click', "Topic: " + $(this).text());
  });


  // Same page links: links which scroll the page or repesent some other
  // interaction on the page
  $('.autoscroll').unbind().on("click", function(){
    console.log($(this).text())
    ga('send', 'event', 'Same-Page-Nav','Click', $(this).text())
  });


    // document.location.href = $(this).data("link");

  // User created a new ticket/discussion
  // Handled on server side with GA MP




};

$(document).on('page:change', Helpy.track);
