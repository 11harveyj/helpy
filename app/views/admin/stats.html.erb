<h1>Admin Stats</h1>

<%

# See: http://stackoverflow.com/a/1341318/1323144
def mean(array)
  array.inject{ |sum, el| sum + el }.to_f / array.size
end

# See: http://stackoverflow.com/a/14859546/1323144
def median(array)
  sorted = array.sort
  len = sorted.length
  (sorted[(len - 1) / 2] + sorted[len / 2]) / 2.0
end

%>

<div class="row">
  <div class="col-md-12">
    <table>
      <tbody>
        <tr>
          <th>Topic Count</th>
          <td><%= Topic.count %></td>
        </tr>
        <tr>
          <th>Topic Count (excluding deleted)</th>
          <td><%= Topic.undeleted.count %></td>
        </tr>
        <tr>
          <th>Unresponded Topics</th>
          <td><%= Topic.undeleted.where('posts_count <= 1').count %></td>
        </tr>
        <tr>
          <th>Responded Topics</th>
          <td><%= Topic.undeleted.where('posts_count > 1').count %></td>
        </tr>
        <% delays = Topic.undeleted.where('posts_count > 1').map { |t| t.posts.second.created_at - t.created_at } %>
        <tr>
          <th>Individual Delay Times (s)</th>
          <td><%= delays %></td>
        </tr>
        <tr>
          <th>Time to first response (seconds)</th>
          <td><%= delays.min %> to <%= delays.max %> (mean = <%= mean(delays) %> / median = <%= median(delays) %>)</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
