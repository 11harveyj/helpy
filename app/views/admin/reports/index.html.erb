<% title "Activity Report" %>

<div class="report-header row">
  <div class="col-md-12 clearfix">
    <h2>
      <%= t('activity_report', site_name: AppSettings['settings.site_name'], default: "Activity Report") %>: <%= content_tag :span, @interval.sentence_case, class: 'hidden-sm hidden-xs' %>
      <div class="dropdown pull-right">
        <button class="btn btn-default dropdown-toggle less-important" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          <%= @interval.sentence_case %>
          <span class="caret"></span>
        </button>
        <%= render partial: 'admin/reports/date_selector', locals: { path: "admin_reports_path" } %>
      </div>
    </h2>
  </div>
</div>
<div class="row">
  <div class="col-md-2 reports-nav">
    <%= render partial: 'admin/reports/reports_nav' %>
  </div>
  <div class="col-md-10">
    <div class="row">
      <div class="big-stats">
        <div class="col-md-3 col-xs-4 text-left">
          <h2><%= number_to_percentage((@total_closed.to_f/@total_tickets.to_f)*100, precision: 0) %></h2>
            <span class="tiny-header">Percent Resolved</span>
        </div>
        <div class="col-md-9 col-xs-8 text-left">
          <h2><%= distance_of_time_in_words(@median_close_time) unless @median_close_time.nil? %></h2>
            <span class="tiny-header">Average Resolution Time</span>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <%= area_chart [
          { name: 'Tickets', data: @tickets },
          { name: 'Closed', data: @closed },
          { name: 'Actions', data: @actions },
          ],
          legend: "bottom",
          # title: "Tickets Received",
          library: { pointRadius: 0 }
          %>

        <%#= pie_chart [
          # ["Closed", @scoped_stats.sum(:number_closed)],
          ["Unanswered", @scoped_stats.sum(:number_of_tickets)-@scoped_stats.sum(:number_closed)],
          ["Responded", @scoped_stats.sum(:number_of_tickets)-@scoped_stats.sum(:responded)]
          ], library: {cutoutPercentage: 50} %>

        <table width="100%" id="reports">
          <col width="80%">
          <col width="0%">
          <col width="20%">

          <tr>
            <td><span class="more-important">New Tickets</span><br/><span class="less-important">The number of new tickets your Helpy has received in this period.</span></td>
            <td></td>
            <td><%= content_tag :h3, @total_tickets, class: 'pull-right' %></td>
          </tr>
          <tr>
            <td><span class="more-important">Replies</span><br/><span class="less-important">The number of replies your agents have written in this period.</span></td>
            <td></td>
            <td><%= content_tag :h3, @total_replies, class: 'pull-right' %></td>
          </tr>
          <tr>
            <td><span class="more-important">Total Actions</span><br/><span class="less-important">The total number of actions (replies or internal notes) in this period. A good indication of how busy your Helpy is overall.</span></td>
            <td></td>
            <td><%= content_tag :h3, @total_activities, class: 'pull-right' %></td>
          </tr>
          <tr>
            <td><span class="more-important">Open Tickets</span><br/><span class="less-important">The number of tickets that are still open during this period.</span></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td><span class="more-important">Tickets Closed</span><br/><span class="less-important">The number of tickets closed during this period. Should be close to the number of new tickets for prior periods.</span></td>
            <td></td>
            <td><%= content_tag :h3, @total_closed, class: 'pull-right' %></td>
          </td>
        </table>
      </div>
    </div>
    <!-- <div class="row">
      <div class="col-md-6">
        <%#= pie_chart assigned_agent_stats(@scoped_stats), title: "Assigned Agents" %>
      </div>
      <div class="col-md-6">
        <%#= pie_chart tickets_by_group(@scoped_stats), title: "Groups" %>
      </div>
    </div> -->
  </div>
</div>
